#'@title Fit SeaBASS model with Gibbs sampler
#'@param data list with AE count (A), confounders (X), vaccine indication (V), number of each categories
#'@param initial list include the parameter initial values, default is from glm fit results
#' @export
SeaBASS_gibbs = function(data,
                      initial = NULL,
                      horseshoe=TRUE,
                      cutoff_beta = 4, cutoff_alpha = 12,
                      a_alpha = 0.01, b_alpha  = 0.01,
                      include_intercept=F,
                      nu_0 = 1, eta2_0 = 1,
                      nu_1 = 1, eta2_1 = 1,
                      mcmc_sample = 500, 
                      burnin = 5000, 
                      thinning = 10,
                      verbose = 500,
                      save_profile = 1,
                      seed=1){


  AEs = colnames(data$A)
  if (include_intercept){
    data$X = cbind(1, data$X)
  }

  J = ncol(data$A)
  p = ncol(data$X)
  
  set.seed(seed)

  if(is.null(initial)) {
    
    glm_coef <- get_glm_coefs(data,cutoff_beta = glm_cutoff)
    init_beta = glm_coef$beta
    init_alpha = glm_coef$alpha
    initial_inv_sigma2_beta = rep(1, J)
    initial_inv_sigma2_alpha = matrix(1, ncol = J, nrow = p)
    initial_inv_a_beta = rep(0.5, J)
    initial_inv_tau2 = 1
    initial_inv_a_tau = 0.5

  } else {
    #need change beta_glm name
    init_beta = initial$beta
    init_alpha = initial$alpha
    initial_inv_sigma2_beta = initial$inv_sigma2_beta
    initial_inv_sigma2_alpha = initial$inv_sigma2_alpha
    initial_inv_a_beta = initial$inv_a_beta
    initial_inv_tau2 = initial$inv_tau2
    initial_inv_a_tau = initial$inv_a_tau
  }

  gibbs_fit <- Gibbs_Vacc_cpp(data$A, data$X, data$V,data$nn,
                           initial_beta = init_beta,
                           initial_alpha = init_alpha,
                           initial_inv_sigma2_beta = initial_inv_sigma2_beta,
                           initial_inv_sigma2_alpha = initial_inv_sigma2_alpha,
                           initial_inv_a_beta = initial_inv_a_beta,
                           initial_inv_tau2 = initial_inv_tau2,
                           initial_inv_a_tau = initial_inv_a_tau,
                           nu_0 = nu_0,
                           eta2_0 = eta2_0,
                           nu_1 = nu_1,
                           eta2_1 = eta2_1,
                           mcmc_sample = mcmc_sample,
                           horseshoe=horseshoe,
                           burnin = burnin,
                           thinning = thinning,
                           verbose = verbose,
                           save_profile = save_profile)
  gibbs_fit[["initial"]] = list(init_beta = init_beta,
                             init_alpha = init_alpha)
  # colnames(gibbs_fit$data$A) = AEs

  return(gibbs_fit)
}



